<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>卡单列表</title>
    <!-- <meta name=""> -->
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="js/common.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/dropload.js"></script>

    <script src="js/axios.min.js"></script>
    <script src="js/data.js"></script>

    <link rel="stylesheet" href="css/mui.min.css">
    <link rel="stylesheet" href="css/style1.css" />
    <link rel="stylesheet" href="css/dropload.css" />
</head>

<body>
    <div id="header" class="mui-bar mui-bar-nav">
        <a onclick="back()" class="mui-icon goleft"><img src="images/left.png"></a>
        <h3 id="title" class="mui-title"><a>卡单列表<span id="listsizeid">(0)</span></a></h3>
    </div>
    <div class="paycon-b content" id="carddetailid">
        <div class="lists">



        </div>
        <div class="dropload-down">
            <div class="dropload-refresh">↑上拉加载更多</div>
            <ul class="data-content">
                <li>内容</li>
                <li>内容</li>
            </ul>
        </div>
    </div>
    <script>
        $(function() {
            //拼接url
            var hreftemp = "http://www.baidu.com/ky/taihaobao/index.html";
            var baseurl = hreftemp.substring(0, hreftemp.indexOf("/ky/") + 4);
            //var userid=sessionStorage.getItem("userid");
            var searchurl = decodeURI("http://www.baidu.com/ky/taihaobao/cardlist.html?userid=3110100|999||8ce6b73ad2118782e5f2034cad2bb8a4|23|%E4%B8%AA%E4%BA%BA%E8%90%A5%E9%94%80|TZZ|%E4%B8%AD%E5%9B%BD%E5%A4%AA%E5%B9%B3%E6%B4%8B%E4%BF%9D%E9%99%A9%E8%82%A1%E4%BB%BD%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%E8%8B%8F%E5%B7%9E%E5%88%86%E5%85%AC%E5%8F%B8|TZW000647|%E9%92%B1%E6%83%A0%E8%8A%B1");
            var postinfo = searchurl.substring(searchurl.indexOf("userid=") + 7);
            var arr = postinfo.split("|");
            var arr1 = postinfo.split("|", 3);
            var userid = arr1.join("|");
            console.log(userid);
            var url = baseurl + "thbcard/list/" + userid;
            var counturl = baseurl + "thbcard/count/" + userid;

            // $.ajax({
            //     type: "get",
            //     url: counturl,
            //     dataType: "json",
            //     contentType: "application/json",
            //     success: function(msg) {
            //         $("#listsizeid").text("(" + (msg.listsize == 'ul' ? "0" : msg.listsize) + ")");
            //     }
            // });

            //jsonp解决跨域
            // function handleResponse(response) {
            //     console.log('The responsed data is: ' + response.data);
            //     localStorage.setItem("responseData", response.data);
            // }
            // var script = document.createElement('script');
            // counturl = "http://www.baidu.com/ky/thbcard/count/3110100|999|"
            // script.src = counturl + encodeURIComponent('?callback=handleResponse');
            // document.body.insertBefore(script, document.body.firstChild);


            //axios
            // axios.get(counturl, {

            //         headers: {
            //             referer: 'http://www.baidu.com/ky/taihaobao/cardlist.html?userid=3110100|999|',
            //             host: 'kayantest.cpic.com.cn'
            //         }
            //     })
            //     .then(function(response) {
            //         console.log(response.data);
            //     })
            //     .catch(function(err) {
            //         console.log(err);
            //     });

            var stt = function scrollToTop() {
                $('html,body').animate({
                    scrollTop: '0px'
                }, 3000);
            }

            // 每页展示10个
            var counter = 0;
            var num = 10;
            var pageStart = 0,
                pageEnd = 0;
            $(".content").dropload({
                scrollArea: window,
                loadDownFn: (me) => {
                    pageStart = num * counter;
                    // $.ajax({
                    //     type: 'get',
                    //     url: 'data.json',
                    //     dataType: 'json',
                    //     success: function(msg) {
                    // $.getJSON('data.json', function(msg) {
                    var msg = data;
                    $("#listsizeid").text("(" + (msg.listsize == 'ul' ? "0" : num + pageStart) + ")");
                    var cardlist = msg.result;
                    var result = '';
                    counter++;
                    pageEnd = pageStart + num;
                    for (var i = 0; i < num; i++) {
                        if ((i) >= cardlist.length) {
                            // 锁定
                            me.lock();
                            // 无数据
                            me.noData();
                            break;
                        }
                        result += '<div class="mt10 widget"><dl class="card-management"><dt><img src="' + cardlist[i].logo + '"/></dt><dd><ul><li><label>' + cardlist[i].name + '</label></li><li><span>渠道展业方式：' + cardlist[i].qdzyfsName + '</span></li><li><span>代理点：' + cardlist[i].agentName + '</span></li><li><span>销售人员：' + cardlist[i].salesManName + '</span></li><li><span>生成时间：' + cardlist[i].createTime + '</span></li></ul></dd><a href="javascript:isremovecard(\'' + cardlist[i].cardId + '\')" data-toggle="dispose" class="close mui-icon"><img src="images/del.png"/></a></dl><dl class="card-bottom"><dd><span><a href="javascript:clickviews(\'' + cardlist[i].cardId + '\')"><em class="mui-icon"><img src="images/eye.png"/></em>查看(' + cardlist[i].pv + ')</a></span><span onclick="clickQrcode(\'' + cardlist[i].cardId + '\',\'' + cardlist[i].name + '\',\'' + cardlist[i].msbUrl + '\')" class="staff-border-r"><a><em class="mui-icon"><img src="images/erweima.png"/></em>二维码</a></span><span class="share" onclick="clickshare(\'' + cardlist[i].title + '\',\'' + cardlist[i].desc + '\',\'' + cardlist[i].imageurl + '\',\'' + cardlist[i].link + '\',\'' + cardlist[i].name + '\',\'' + cardlist[i].msbUrl + '\')" ><a><em class="mui-icon"><img src="images/share.png"/></em>分享</a></span>		</dd></dl></div>';
                    }
                    $('.lists').append(result);
                    // 每次数据加载完，必须重置
                    me.resetload();
                    // },
                    // error: function(xhr, type) {
                    //     alert('加载数据失败!');
                    //     // 即使加载出错，也得重置
                    //     me.resetload();
                    // }
                    // });
                }
            })
        });
    </script>

</html>
